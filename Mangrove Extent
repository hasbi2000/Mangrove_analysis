GEE link: https://code.earthengine.google.com/?scriptPath=users%2Fhasbikhususjupyter%2FMangrove%3A2024

var ROI = ee.FeatureCollection("users/hasbikhususjupyter/ROI_EE"),
    Landsat8 = ee.ImageCollection("LANDSAT/LC08/C02/T1_L2"),
    DEM = ee.Image("USGS/SRTMGL1_003"),
    Mangrove = 
    /* color: #d63000 */
    /* shown: false */
    /* locked: true */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35114752976453, 0.7611401809514832],
                  [103.35114752976453, 0.7605716027765446],
                  [103.35178053109205, 0.7605716027765446],
                  [103.35178053109205, 0.7611401809514832]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35149085251844, 0.7603248612811037],
                  [103.35149085251844, 0.7599815687422384],
                  [103.35188781945264, 0.7599815687422384],
                  [103.35188781945264, 0.7603248612811037]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35157668320691, 0.7596811877483481],
                  [103.35157668320691, 0.75931643937056],
                  [103.35193073479688, 0.75931643937056],
                  [103.35193073479688, 0.7596811877483481]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35172688691175, 0.7618696773680123],
                  [103.35172688691175, 0.7613976502890535],
                  [103.35224187104261, 0.7613976502890535],
                  [103.35224187104261, 0.7618696773680123]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35223114220655, 0.7622236976432853],
                  [103.35223114220655, 0.7620091399041614],
                  [103.35243499009168, 0.7620091399041614],
                  [103.35243499009168, 0.7622236976432853]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35098043857046, 0.7617256450483383],
                  [103.35098043857046, 0.7613394410655888],
                  [103.35140959201284, 0.7613394410655888],
                  [103.35140959201284, 0.7617256450483383]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35101262507864, 0.7624336855934647],
                  [103.35101262507864, 0.7622513115247955],
                  [103.35122720179983, 0.7622513115247955],
                  [103.35122720179983, 0.7624336855934647]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3515276092095, 0.7632919164011611],
                  [103.3515276092095, 0.7626375154258048],
                  [103.35222498355337, 0.7626375154258048],
                  [103.35222498355337, 0.7632919164011611]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35100726066061, 0.7639624091005082],
                  [103.35100726066061, 0.7632543688069127],
                  [103.35143641410299, 0.7632543688069127],
                  [103.35143641410299, 0.7639624091005082]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35180119452902, 0.7640482321584745],
                  [103.35180119452902, 0.7633616476467555],
                  [103.35259512839743, 0.7633616476467555],
                  [103.35259512839743, 0.7640482321584745]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3515651601357, 0.7649245628040571],
                  [103.3515651601357, 0.7642379784324098],
                  [103.35220889029928, 0.7642379784324098],
                  [103.35220889029928, 0.7649245628040571]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35096434531637, 0.7663835542289439],
                  [103.35096434531637, 0.7657827931141239],
                  [103.35152224479147, 0.7657827931141239],
                  [103.35152224479147, 0.7663835542289439]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35107163367697, 0.7654395010107021],
                  [103.35107163367697, 0.7649460185638987],
                  [103.35158661780783, 0.7649460185638987],
                  [103.35158661780783, 0.7654395010107021]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35105017600485, 0.7674992532185879],
                  [103.35105017600485, 0.766877036510244],
                  [103.3515651601357, 0.766877036510244],
                  [103.3515651601357, 0.7674992532185879]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35160807547994, 0.7666195675010086],
                  [103.35160807547994, 0.7662977312177063],
                  [103.35186556754537, 0.7662977312177063],
                  [103.35186556754537, 0.7666195675010086]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35092142997213, 0.7668126692593823],
                  [103.35092142997213, 0.7664479214862557],
                  [103.35137204108663, 0.7664479214862557],
                  [103.35137204108663, 0.7668126692593823]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35102871833273, 0.7679498238819257],
                  [103.35102871833273, 0.7675850762057425],
                  [103.35165099082418, 0.7675850762057425],
                  [103.35165099082418, 0.7679498238819257]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35095564298818, 0.768596977024566],
                  [103.35095564298818, 0.7680820391977046],
                  [103.35136333875845, 0.7680820391977046],
                  [103.35136333875845, 0.768596977024566]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35123459272573, 0.7698628655849458],
                  [103.35123459272573, 0.7687900786936296],
                  [103.35138479643057, 0.7687900786936296],
                  [103.35138479643057, 0.7698628655849458]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35071960859487, 0.7705709047853718],
                  [103.35071960859487, 0.7702705245329453],
                  [103.35104147367666, 0.7702705245329453],
                  [103.35104147367666, 0.7705709047853718]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35071960859487, 0.77138408579347],
                  [103.35071960859487, 0.7709120597630382],
                  [103.35114876203725, 0.7709120597630382],
                  [103.35114876203725, 0.77138408579347]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35065523557851, 0.7725641506403965],
                  [103.35065523557851, 0.7718132003211516],
                  [103.35114876203725, 0.7718132003211516],
                  [103.35114876203725, 0.7725641506403965]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35054794721792, 0.7734438351312741],
                  [103.35054794721792, 0.7728430750108991],
                  [103.35102001600454, 0.7728430750108991],
                  [103.35102001600454, 0.7734438351312741]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35020462446401, 0.7736583922965369],
                  [103.35020462446401, 0.7734009236969316],
                  [103.35050503187368, 0.7734009236969316],
                  [103.35050503187368, 0.7736583922965369]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35070887975881, 0.7742484244450158],
                  [103.35070887975881, 0.773712031586151],
                  [103.35088054113577, 0.773712031586151],
                  [103.35088054113577, 0.7742484244450158]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35042993002126, 0.7756645012662136],
                  [103.35042993002126, 0.7753212099591009],
                  [103.3505801337261, 0.7753212099591009],
                  [103.3505801337261, 0.7756645012662136]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35042993002126, 0.7747848172360076],
                  [103.35042993002126, 0.7745058929931598],
                  [103.35062304907034, 0.7745058929931598],
                  [103.35062304907034, 0.7747848172360076]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35049569784398, 0.7774963775096526],
                  [103.35049569784398, 0.7766381495614147],
                  [103.35086047827001, 0.7766381495614147],
                  [103.35086047827001, 0.7774963775096526]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35043132482762, 0.7788480861743194],
                  [103.35043132482762, 0.7779684028068392],
                  [103.3506244438767, 0.7779684028068392],
                  [103.3506244438767, 0.7788480861743194]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34989488302465, 0.7801783387226426],
                  [103.34989488302465, 0.7793844783814504],
                  [103.3504098671555, 0.7793844783814504],
                  [103.3504098671555, 0.7801783387226426]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34980905233617, 0.7820449827182495],
                  [103.34980905233617, 0.7812511227294883],
                  [103.35034549413915, 0.7812511227294883],
                  [103.35034549413915, 0.7820449827182495]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34953010259862, 0.7840403598644929],
                  [103.34953010259862, 0.7829246652331121],
                  [103.35019529043431, 0.7829246652331121],
                  [103.35019529043431, 0.7840403598644929]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34989488302465, 0.7826242858585314],
                  [103.34989488302465, 0.7822809951183843],
                  [103.35025966345067, 0.7822809951183843],
                  [103.35025966345067, 0.7826242858585314]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34957301794286, 0.7844909287659942],
                  [103.34957301794286, 0.7841047268533915],
                  [103.35019529043431, 0.7841047268533915],
                  [103.35019529043431, 0.7844909287659942]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3483235756055, 0.7904437005784619],
                  [103.3483235756055, 0.7896283865515314],
                  [103.3490960518018, 0.7896283865515314],
                  [103.3490960518018, 0.7904437005784619]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34877418672001, 0.7893494632950754],
                  [103.34877418672001, 0.7888345280032434],
                  [103.34924625550663, 0.7888345280032434],
                  [103.34924625550663, 0.7893494632950754]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3485381523267, 0.7909157244156341],
                  [103.3485381523267, 0.7905724343575633],
                  [103.3489887634412, 0.7905724343575633],
                  [103.3489887634412, 0.7909157244156341]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34793098214313, 0.7921850757231703],
                  [103.34793098214313, 0.7842893996331868],
                  [103.3523941779439, 0.7842893996331868],
                  [103.3523941779439, 0.7921850757231703]]], null, false),
            {
              "Vegetasi": 1,
              "system:index": "37"
            })]),
    NonMangrove = 
    /* color: #088b1b */
    /* shown: false */
    /* locked: true */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35181637422228, 0.7908676060803501],
                  [103.35181637422228, 0.7902668484531229],
                  [103.35261030809069, 0.7902668484531229],
                  [103.35261030809069, 0.7908676060803501]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35267468110705, 0.7895373569318364],
                  [103.35267468110705, 0.7889365991123127],
                  [103.35293217317248, 0.7889365991123127],
                  [103.35293217317248, 0.7895373569318364]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35235281602526, 0.7877565388571911],
                  [103.35235281602526, 0.7870485025436654],
                  [103.35321112291003, 0.7870485025436654],
                  [103.35321112291003, 0.7877565388571911]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35203095094347, 0.7884002081287157],
                  [103.35203095094347, 0.7880783735053702],
                  [103.35230990068102, 0.7880783735053702],
                  [103.35230990068102, 0.7884002081287157]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35361881868029, 0.7870055912480841],
                  [103.35361881868029, 0.7864477443652099],
                  [103.35402651445055, 0.7864477443652099],
                  [103.35402651445055, 0.7870055912480841]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35572167054796, 0.7860615426334153],
                  [103.35572167054796, 0.7856967965205638],
                  [103.35610790864611, 0.7856967965205638],
                  [103.35610790864611, 0.7860615426334153]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3572237075963, 0.7859328087148658],
                  [103.3572237075963, 0.7854393286570279],
                  [103.35760994569445, 0.7854393286570279],
                  [103.35760994569445, 0.7859328087148658]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35730953828478, 0.7891082442124526],
                  [103.35730953828478, 0.7886576758094588],
                  [103.35765286103869, 0.7886576758094588],
                  [103.35765286103869, 0.7891082442124526]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.37011976853991, 0.7882929299236862],
                  [103.37011976853991, 0.7876063493461861],
                  [103.3708922447362, 0.7876063493461861],
                  [103.3708922447362, 0.7882929299236862]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.37265177384997, 0.7883787524879287],
                  [103.37265177384997, 0.7879281840059807],
                  [103.37308092729235, 0.7879281840059807],
                  [103.37308092729235, 0.7883787524879287]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35316820756579, 0.7853320503758813],
                  [103.35316820756579, 0.7848385702471298],
                  [103.3534042419591, 0.7848385702471298],
                  [103.3534042419591, 0.7853320503758813]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35170142769194, 0.7874439800577281],
                  [103.35170142769194, 0.7868003106385367],
                  [103.35219495415068, 0.7868003106385367],
                  [103.35219495415068, 0.7874439800577281]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35187308906889, 0.7863068306832272],
                  [103.35187308906889, 0.7859206289383796],
                  [103.35223786949491, 0.7859206289383796],
                  [103.35223786949491, 0.7863068306832272]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35316054939604, 0.7844616442468288],
                  [103.35316054939604, 0.7840968979944273],
                  [103.35343949913359, 0.7840968979944273],
                  [103.35343949913359, 0.7844616442468288]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3535682451663, 0.7835390507233981],
                  [103.3535682451663, 0.7830026590465928],
                  [103.35399739860868, 0.7830026590465928],
                  [103.35399739860868, 0.7835390507233981]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35618608116484, 0.7823375332720328],
                  [103.35618608116484, 0.7818655084648424],
                  [103.35661523460722, 0.7818655084648424],
                  [103.35661523460722, 0.7823375332720328]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35483424782133, 0.7845045555685543],
                  [103.35483424782133, 0.7841183536571983],
                  [103.3550273668704, 0.7841183536571983],
                  [103.3550273668704, 0.7845045555685543]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35131518959379, 0.7848263904674503],
                  [103.35131518959379, 0.7843972772634136],
                  [103.35172288536405, 0.7843972772634136],
                  [103.35172288536405, 0.7848263904674503]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35365407585478, 0.7822731662559979],
                  [103.35365407585478, 0.7809214586912813],
                  [103.35406177162504, 0.7809214586912813],
                  [103.35406177162504, 0.7822731662559979]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35425489067411, 0.7816938630672571],
                  [103.35425489067411, 0.7813291165740621],
                  [103.35461967110014, 0.7813291165740621],
                  [103.35461967110014, 0.7816938630672571]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35494821911914, 0.780530855173687],
                  [103.35494821911914, 0.7802304756279161],
                  [103.3553559148894, 0.7802304756279161],
                  [103.3553559148894, 0.780530855173687]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35477655774218, 0.7770121220074965],
                  [103.35477655774218, 0.7765830080059802],
                  [103.3552486265288, 0.7765830080059802],
                  [103.3552486265288, 0.7770121220074965]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35305994397265, 0.7776343372322772],
                  [103.35305994397265, 0.7773125017826363],
                  [103.35338180905444, 0.7773125017826363],
                  [103.35338180905444, 0.7776343372322772]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3523303831206, 0.7767975650121899],
                  [103.3523303831206, 0.7764757294987981],
                  [103.35260933285815, 0.7764757294987981],
                  [103.35260933285815, 0.7767975650121899]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3523303831206, 0.7776772486237077],
                  [103.3523303831206, 0.7772910460851209],
                  [103.35269516354663, 0.7772910460851209],
                  [103.35269516354663, 0.7776772486237077]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35284536725146, 0.7769906663084671],
                  [103.35284536725146, 0.7764328180951668],
                  [103.35336035138232, 0.7764328180951668],
                  [103.35336035138232, 0.7769906663084671]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35220163708789, 0.7761538939609032],
                  [103.35220163708789, 0.7755531342247265],
                  [103.35280245190722, 0.7755531342247265],
                  [103.35280245190722, 0.7761538939609032]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35314577466113, 0.7744588930574883],
                  [103.35314577466113, 0.7737079430734229],
                  [103.35351055508715, 0.7737079430734229],
                  [103.35351055508715, 0.7744588930574883]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35557049161059, 0.7748665515646501],
                  [103.35557049161059, 0.7745661716158521],
                  [103.35584944134814, 0.7745661716158521],
                  [103.35584944134814, 0.7748665515646501]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3559138143645, 0.7753600328628789],
                  [103.3559138143645, 0.7750381972401269],
                  [103.35599964505298, 0.7750381972401269],
                  [103.35599964505298, 0.7753600328628789]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35619276410205, 0.7740941459390089],
                  [103.35619276410205, 0.7738152216507174],
                  [103.35630005246264, 0.7738152216507174],
                  [103.35630005246264, 0.7740941459390089]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35975473767382, 0.774930918693773],
                  [103.35975473767382, 0.7746734501714423],
                  [103.36011951809985, 0.7746734501714423],
                  [103.36011951809985, 0.774930918693773]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.36419647580249, 0.7778918055744738],
                  [103.36419647580249, 0.7775056030555046],
                  [103.3643252218352, 0.7775056030555046],
                  [103.3643252218352, 0.7778918055744738]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35265224820239, 0.7744374373455712],
                  [103.35265224820239, 0.7741799687932545],
                  [103.35282390957934, 0.7741799687932545],
                  [103.35282390957934, 0.7744374373455712]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35456198102099, 0.7720665805026696],
                  [103.35456198102099, 0.7713799972784902],
                  [103.35484093075854, 0.7713799972784902],
                  [103.35484093075854, 0.7720665805026696]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35563486462695, 0.772302593460381],
                  [103.35563486462695, 0.7718091118066044],
                  [103.3559138143645, 0.7718091118066044],
                  [103.3559138143645, 0.772302593460381]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35331743603808, 0.7720880362266472],
                  [103.35331743603808, 0.7712727186397219],
                  [103.3537895048247, 0.7712727186397219],
                  [103.3537895048247, 0.7720880362266472]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3528882825957, 0.7729891765355452],
                  [103.3528882825957, 0.772645885011824],
                  [103.35318869000537, 0.772645885011824],
                  [103.35318869000537, 0.7729891765355452]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3524376714812, 0.7716374660005468],
                  [103.3524376714812, 0.7709937941662203],
                  [103.3528882825957, 0.7709937941662203],
                  [103.3528882825957, 0.7716374660005468]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35396116620166, 0.7704788566286876],
                  [103.35396116620166, 0.7700282862322876],
                  [103.35456198102099, 0.7700282862322876],
                  [103.35456198102099, 0.7704788566286876]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35743730908496, 0.7715087316414649],
                  [103.35743730908496, 0.7710367056248623],
                  [103.35778063183886, 0.7710367056248623],
                  [103.35778063183886, 0.7715087316414649]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35528496410107, 0.7688960891254157],
                  [103.35528496410107, 0.7679091249718731],
                  [103.35618618633008, 0.7679091249718731],
                  [103.35618618633008, 0.7688960891254157]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35682991649365, 0.7679091249718731],
                  [103.35682991649365, 0.7674370985569887],
                  [103.35717323924756, 0.7674370985569887],
                  [103.35717323924756, 0.7679091249718731]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35421208049512, 0.766364311056749],
                  [103.35421208049512, 0.7662355765386522],
                  [103.35434082652783, 0.7662355765386522],
                  [103.35434082652783, 0.766364311056749]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35622910167432, 0.7643474698292007],
                  [103.35622910167432, 0.7638754430220648],
                  [103.35661533977246, 0.7638754430220648],
                  [103.35661533977246, 0.7643474698292007]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35579994823193, 0.7622448045622813],
                  [103.35579994823193, 0.7615582197628747],
                  [103.3561003556416, 0.7615582197628747],
                  [103.3561003556416, 0.7622448045622813]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.36687210704541, 0.766493045570991],
                  [103.36687210704541, 0.7659781074908939],
                  [103.36695793773389, 0.7659781074908939],
                  [103.36695793773389, 0.766493045570991]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.37249401714062, 0.7625880969209744],
                  [103.37249401714062, 0.7619444237260702],
                  [103.37275150920605, 0.7619444237260702],
                  [103.37275150920605, 0.7625880969209744]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3901751389668, 0.7689390006053038],
                  [103.3901751389668, 0.7683811513346982],
                  [103.39313629771924, 0.7683811513346982],
                  [103.39313629771924, 0.7689390006053038]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.39129093791699, 0.7704409021251253],
                  [103.39129093791699, 0.7694968498029475],
                  [103.39159134532666, 0.7694968498029475],
                  [103.39159134532666, 0.7704409021251253]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35476997997021, 0.7614723966552791],
                  [103.35476997997021, 0.7606999886098337],
                  [103.35545662547803, 0.7606999886098337],
                  [103.35545662547803, 0.7614723966552791]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35622910167432, 0.7590693489489455],
                  [103.35622910167432, 0.7583827636444798],
                  [103.3577740540669, 0.7583827636444798],
                  [103.3577740540669, 0.7590693489489455]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35897568370557, 0.7620731583727887],
                  [103.35897568370557, 0.7606999886098719],
                  [103.36017731334424, 0.7606999886098719],
                  [103.36017731334424, 0.7620731583727887]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.36755875255322, 0.7610432810916016],
                  [103.36755875255322, 0.7604425192306618],
                  [103.36807373668408, 0.7604425192306618],
                  [103.36807373668408, 0.7610432810916016]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.37322357799268, 0.7624164507451455],
                  [103.37322357799268, 0.76147239665533],
                  [103.37365273143506, 0.76147239665533],
                  [103.37365273143506, 0.7624164507451455]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.37408188487744, 0.7550356587277485],
                  [103.37408188487744, 0.7532333703968532],
                  [103.37554100658154, 0.7532333703968532],
                  [103.37554100658154, 0.7550356587277485]]], null, false),
            {
              "Vegetasi": 0,
              "system:index": "55"
            })]),
    ROI_2 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34710812616312, 0.7927515983938851],
                  [103.34749436426127, 0.7870873113132875],
                  [103.34869599389994, 0.778676689048288],
                  [103.34938263940775, 0.7718108625061108],
                  [103.35064864206278, 0.7593236121410406],
                  [103.35152840661966, 0.7582937342040867],
                  [103.35506892251932, 0.7591090542577358],
                  [103.35273003625834, 0.7667902198258126],
                  [103.35187172937357, 0.7749863086655275],
                  [103.35062718439066, 0.7865723757418592],
                  [103.35024094629252, 0.7929232433362312]]]),
            {
              "ROI": 3,
              "system:index": "0"
            })]),
    mangroves = 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[103.3482331829288, 0.7914094357548718],
                  [103.3482331829288, 0.7904224768787727],
                  [103.34874816705965, 0.7904224768787727],
                  [103.34874816705965, 0.7914094357548718]]], null, false),
            {
              "vegetasi": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34934898187899, 0.7872899536763264],
                  [103.34934898187899, 0.786002614691091],
                  [103.34994979669833, 0.786002614691091],
                  [103.34994979669833, 0.7872899536763264]]], null, false),
            {
              "vegetasi": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35145943489147, 0.7644713453265726],
                  [103.35145943489147, 0.7622399454823726],
                  [103.35231774177623, 0.7622399454823726],
                  [103.35231774177623, 0.7644713453265726]]], null, false),
            {
              "vegetasi": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35164564333377, 0.7600918637734319],
                  [103.35164564333377, 0.7595769249271265],
                  [103.35276144228396, 0.7595769249271265],
                  [103.35276144228396, 0.7600918637734319]]], null, false),
            {
              "vegetasi": 1,
              "system:index": "3"
            })]),
    nonmangroves = 
    /* color: #98ff00 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      },
      {
        "type": "rectangle"
      }
    ] */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35300438728405, 0.7670460360134098],
                  [103.35300438728405, 0.7658445138853314],
                  [103.35386269416881, 0.7658445138853314],
                  [103.35386269416881, 0.7670460360134098]]], null, false),
            {
              "vegetasi": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35377686348033, 0.7622399454823726],
                  [103.35377686348033, 0.7612100682410442],
                  [103.3546351703651, 0.7612100682410442],
                  [103.3546351703651, 0.7622399454823726]]], null, false),
            {
              "vegetasi": 0,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.35234099489406, 0.7718360512703488],
                  [103.35234099489406, 0.7699479470351526],
                  [103.3532851324673, 0.7699479470351526],
                  [103.3532851324673, 0.7718360512703488]]], null, false),
            {
              "vegetasi": 0,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[103.34969470281196, 0.7896113011904019],
                  [103.34969470281196, 0.7884956080477877],
                  [103.35089633245063, 0.7884956080477877],
                  [103.35089633245063, 0.7896113011904019]]], null, false),
            {
              "vegetasi": 0,
              "system:index": "3"
            })]);

var Vis = {opacity: 0.1};
Map.addLayer(ROI, Vis, 'ROI');
Map.setOptions('satellite')
Map.centerObject(ROI, 13)

function mask_clouds(image) {
    var BQA = image.select('QA_PIXEL')
    var BQS = image.select('QA_RADSAT')
    var cloud_mask = BQA.bitwiseAnd(parseInt('11111', 2)).eq(0)  
    var saturation_mask = BQS.eq(0)
    var combined_mask = cloud_mask.and(saturation_mask)
    var masked_image = image.updateMask(combined_mask)
    return masked_image
}

function applyScaleFactors(image) {
  var opticalBands = image.select('SR_B1', 'SR_B2', 'SR_B3', 'SR_B4', 'SR_B5', 'SR_B6', 'SR_B7').multiply(0.0000275).add(-0.2);
  var thermalBands = image.select('ST_B10*').multiply(0.00341802).add(149.0);
  return image.addBands(opticalBands, null, true)
              .addBands(thermalBands, null, true);
}

function addIndices(image) {
    var X1 = image.select('SR_B5')
    var X2 = image.select('SR_B4')
    var X3 = image.select('SR_B6')
    var X4 = image.select('SR_B3')
    var ndvi = X1.subtract(X2).divide(X1.add(X2)).rename('NDVI')
    var ndmi = X1.subtract(X3).divide(X2.add(X3)).rename('NDMI')
    var mndwi = X4.subtract(X3).divide(X4.add(X3)).rename('MNDWI')
    var sr = X1.divide(X2).rename('SR')
    var r54 = X3.divide(X1).rename('R54')
    var r35 = X2.divide(X3).rename('R35')
    var gcvi = X1.divide(X4).subtract(1).rename('GCVI')
    return image.addBands([ndvi, ndmi, mndwi, sr, r54, r35, gcvi])
}

var year = 2023;
var startDate = (year-1)+'-01-01';
var endDate = (year+1)+'-12-31';

var L8 = Landsat8.filterDate(startDate, endDate)
.map(mask_clouds)
.map(applyScaleFactors)
.map(addIndices)
;


var composite2 = L8.median().clip(ROI_2)
var SRTMclip2 = DEM.clip(ROI_2);
var elevationDEM2 = SRTMclip2.lt(65);

var ndvi_mask2 = composite2.select('NDVI').gt(0.25);
var mndwi_mask2 = composite2.select('MNDWI').gt(-0.50);

var Cmps2 = composite2
.updateMask(ndvi_mask2)
.updateMask(mndwi_mask2)
.updateMask(elevationDEM2);

var vis_params = {
    bands: ['SR_B5', 'SR_B6', 'SR_B4'],min : 0, max: 0.3,gamma: 2.4};
    
//Map.addLayer(Cmps, vis_params, "Indeces")
Map.addLayer(Cmps2, vis_params, "Check")

////////var classes = Mangrove.merge(NonMangrove);
//////var bands = ['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI'];
////var image = Cmps.select(bands).clip(ROI);
//var samples = image.sampleRegions({
//  collection: classes, properties: ['Vegetasi'], scale: 30
//}).randomColumn('random');

//var split = 0.8
//var training = samples.filter(ee.Filter.lt('random', split));
//var testing = samples.filter(ee.Filter.gte('random', split));

//print('samples n =', samples.aggregate_count('.all'));
//print('samples n =', training.aggregate_count('.all'));
//print('samples n =', testing.aggregate_count('.all'));

//var classifier = ee.Classifier.smileRandomForest(100,5).train({
  //features:training.select(['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI', 'Vegetasi']), 
  //classProperty: 'Vegetasi', 
  //inputProperties: bands
//});

//var validation = testing.classify(classifier);
//var testAccuracy = validation.errorMatrix('Vegetasi', 'classification');
//print('Validation error matrix RF', testAccuracy);
//print('Validation overall accuracy RF', testAccuracy.accuracy());

//var classifiedrf = image.select(bands).classify(classifier);
//var pixelcount = classifiedrf.connectedPixelCount(100, false);
//var countmask = pixelcount.select(0).gt(25);

//var classmask = classifiedrf.select('classification').gt(0);
//var classed = classifiedrf.updateMask(countmask).updateMask(classmask);

//Map.addLayer(classed, {min: 1, max: 2, palette: 'red'}, 'Mangrove')

var classes = mangroves.merge(nonmangroves);
var bands = ['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI'];
var image = Cmps2.select(bands).clip(ROI_2);
var samples = image.sampleRegions({
  collection: classes, properties: ['vegetasi'], scale: 30
}).randomColumn('random');

var split = 0.8
var training = samples.filter(ee.Filter.lt('random', split));
var testing = samples.filter(ee.Filter.gte('random', split));

print('samples n =', samples.aggregate_count('.all'));
print('samples n =', training.aggregate_count('.all'));
print('samples n =', testing.aggregate_count('.all'));

var classifier = ee.Classifier.smileRandomForest(100,5).train({
  features:training.select(['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI', 'vegetasi']), 
  classProperty: 'vegetasi', 
  inputProperties: bands
});

var validation = testing.classify(classifier);
var testAccuracy = validation.errorMatrix('vegetasi', 'classification');
print('Validation error matrix RF', testAccuracy);
print('Validation overall accuracy RF', testAccuracy.accuracy());

var classifiedrf = image.select(bands).classify(classifier);
var pixelcount = classifiedrf.connectedPixelCount(100, false);
var countmask = pixelcount.select(0).gt(25);

var classmask = classifiedrf.select('classification').gt(0);
var classed1 = classifiedrf.updateMask(countmask).updateMask(classmask);

Map.addLayer(classed1, {min: 1, max: 2, palette: 'red'}, 'Mangrove2')

var year1 = 2014;
var startDate1 = (year1-1)+'-01-01';
var endDate1 = (year1+1)+'-12-31';

var L81 = Landsat8.filterDate(startDate1, endDate1)
.map(mask_clouds)
.map(applyScaleFactors)
.map(addIndices)
;

var composite = L81.median().clip(ROI_2)
var SRTMclip = DEM.clip(ROI_2);
var elevationDEM = SRTMclip2.lt(65);

var ndvi_mask = composite.select('NDVI').gt(0.25);
var mndwi_mask = composite.select('MNDWI').gt(-0.50);

var Cmps = composite
.updateMask(ndvi_mask)
.updateMask(mndwi_mask)
.updateMask(elevationDEM);

var vis_params = {
    bands: ['SR_B5', 'SR_B6', 'SR_B4'],min : 0, max: 0.3,gamma: 2.4};

Map.addLayer(Cmps, vis_params, "Check2")

var classes = mangroves.merge(nonmangroves);
var bands = ['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI'];
var image = Cmps.select(bands).clip(ROI_2);
var samples = image.sampleRegions({
  collection: classes, properties: ['vegetasi'], scale: 30
}).randomColumn('random');

var split = 0.8
var training = samples.filter(ee.Filter.lt('random', split));
var testing = samples.filter(ee.Filter.gte('random', split));

print('samples n =', samples.aggregate_count('.all'));
print('samples n =', training.aggregate_count('.all'));
print('samples n =', testing.aggregate_count('.all'));

var classifier = ee.Classifier.smileRandomForest(100,5).train({
  features:training.select(['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI', 'vegetasi']), 
  classProperty: 'vegetasi', 
  inputProperties: bands
});

var validation = testing.classify(classifier);
var testAccuracy = validation.errorMatrix('vegetasi', 'classification');
print('Validation error matrix RF', testAccuracy);
print('Validation overall accuracy RF', testAccuracy.accuracy());

var classifiedrf = image.select(bands).classify(classifier);
var pixelcount = classifiedrf.connectedPixelCount(100, false);
var countmask = pixelcount.select(0).gt(25);

var classmask = classifiedrf.select('classification').gt(0);
var classed3 = classifiedrf.updateMask(countmask).updateMask(classmask);

Map.addLayer(classed3, {min: 1, max: 2, palette: 'yellow'}, 'Mangrove3')

var year2 = 2019;
var startDate2 = (year2-1)+'-01-01';
var endDate2 = (year2+1)+'-12-31';

var L82 = Landsat8.filterDate(startDate2, endDate2)
.map(mask_clouds)
.map(applyScaleFactors)
.map(addIndices)
;

var composite3 = L82.median().clip(ROI_2)
var SRTMclip = DEM.clip(ROI_2);
var elevationDEM = SRTMclip.lt(65);

var ndvi_mask3 = composite3.select('NDVI').gt(0.25);
var mndwi_mask3 = composite3.select('MNDWI').gt(-0.50);

var Cmps3 = composite3
.updateMask(ndvi_mask3)
.updateMask(mndwi_mask3)
.updateMask(elevationDEM);

var vis_params = {
    bands: ['SR_B5', 'SR_B6', 'SR_B4'],min : 0, max: 0.3,gamma: 2.4};

Map.addLayer(Cmps3, vis_params, "Check3")

var classes = mangroves.merge(nonmangroves);
var bands = ['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI'];
var image = Cmps3.select(bands).clip(ROI_2);
var samples = image.sampleRegions({
  collection: classes, properties: ['vegetasi'], scale: 30
}).randomColumn('random');

var split = 0.8
var training = samples.filter(ee.Filter.lt('random', split));
var testing = samples.filter(ee.Filter.gte('random', split));

print('samples n =', samples.aggregate_count('.all'));
print('samples n =', training.aggregate_count('.all'));
print('samples n =', testing.aggregate_count('.all'));

var classifier = ee.Classifier.smileRandomForest(100,5).train({
  features:training.select(['SR_B5', 'SR_B6', 'SR_B4', 'NDVI', 'MNDWI', 'SR', 'GCVI', 'vegetasi']), 
  classProperty: 'vegetasi', 
  inputProperties: bands
});

var validation = testing.classify(classifier);
var testAccuracy = validation.errorMatrix('vegetasi', 'classification');
print('Validation error matrix RF', testAccuracy);
print('Validation overall accuracy RF', testAccuracy.accuracy());

var classifiedrf = image.select(bands).classify(classifier);
var pixelcount = classifiedrf.connectedPixelCount(100, false);
var countmask = pixelcount.select(0).gt(25);

var classmask = classifiedrf.select('classification').gt(0);
var classed4 = classifiedrf.updateMask(countmask).updateMask(classmask);

Map.addLayer(classed4, {min: 1, max: 2, palette: 'green'}, 'Mangrove4')

var area2023 = classed1.multiply(ee.Image.pixelArea()).divide(10000).reduceRegion({
  reducer: ee.Reducer.sum(),
  geometry: ROI_2,
  scale:30,
  maxPixels: 1e13,
  tileScale: 16
}).get('classification')
print(area2023, 'Mangrove 2023 (ha)')

var area2019 = classed4.multiply(ee.Image.pixelArea()).divide(10000).reduceRegion({
  reducer: ee.Reducer.sum(),
  geometry: ROI_2,
  scale:30,
  maxPixels: 1e13,
  tileScale: 16
}).get('classification')
print(area2023, 'Mangrove 2019 (ha)')

var area2013 = classed3.multiply(ee.Image.pixelArea()).divide(10000).reduceRegion({
  reducer: ee.Reducer.sum(),
  geometry: ROI_2,
  scale:30,
  maxPixels: 1e13,
  tileScale: 16
}).get('classification')
print(area2023, 'Mangrove 2013 (ha)')

var sampledata = classifiedrf.stratifiedSample({
  numPoints: 150,
  classBand:'classification',
  region: ROI_2,
  scale: 30,
  geometries: true
});

var stratBuff = function(feature) {
  var num = feature.get('classification');
  return feature.buffer(15).set('classification', num);
};

var stratPoints = sampledata.map(stratBuff)

Export.image.toDrive({
  image: classed1,
  description: '2023SawangLautExtent',
  region: ROI_2,
  scale: 30,
  maxPixels: 1e13
});

Export.image.toDrive({
  image: classed4,
  description: '2019SawangLautExtent',
  region: ROI_2,
  scale: 30,
  maxPixels: 1e13
});

Export.image.toDrive({
  image: classed3,
  description: '2013SawangLautExtent',
  region: ROI_2,
  scale: 30,
  maxPixels: 1e13
});

Export.table.toDrive({
  collection: stratPoints,
  description: 'StratifiedrandomPoints',
  fileFormat: 'SHP',
});
